# 智能投注策略系统

## 📊 系统概述

基于TOP15预测结果的智能投注策略系统，通过渐进式投注方法实现收益最大化。

## 💰 投注规则

- **购买方式**: 从TOP15预测中选择TOP5数字购买
- **单注成本**: 每个数字1元，共5元
- **命中奖励**: 45元/次
- **未中惩罚**: 15元/次

## 🎯 三种投注策略

### 1. 马丁格尔策略（激进型）

**原理**: 连续亏损时，增加投注倍数以覆盖之前所有亏损并实现盈利

**计算公式**:
```
所需倍数 = ⌈(累计亏损 + 期望利润) / (奖励 - 单次成本)⌉
```

**优点**:
- ✓ 收益潜力最大
- ✓ 能快速覆盖亏损
- ✓ 适合高命中率场景

**缺点**:
- ✗ 风险较高
- ✗ 需要较大资金储备
- ✗ 连续亏损时压力大

**适用场景**: 命中率 > 40%

**示例**:
```
期数  倍数  投注   结果   盈亏    累计
1     1     5元    未中   -15元   -15元
2     2     10元   未中   -30元   -45元
3     4     20元   命中   +160元  +115元 ✓
```

### 2. 斐波那契策略（稳健型）

**原理**: 按斐波那契数列（1,1,2,3,5,8,13...）增加投注倍数

**数列**: 1 → 1 → 2 → 3 → 5 → 8 → 13 → 21...

**优点**:
- ✓ 增长较缓和
- ✓ 风险可控
- ✓ 各种场景都较稳健

**缺点**:
- ✗ 覆盖亏损速度较慢
- ✗ 收益中等

**适用场景**: 命中率 35-40%

**示例**:
```
期数  倍数  投注   结果   盈亏    累计
1     1     5元    未中   -15元   -15元
2     1     5元    未中   -15元   -30元
3     2     10元   未中   -30元   -60元
4     3     15元   命中   +120元  +60元 ✓
```

### 3. 达朗贝尔策略（保守型）

**原理**: 每次亏损只增加1个单位倍数

**公式**: 倍数 = 1 + 连续亏损次数

**优点**:
- ✓ 最安全
- ✓ 资金需求小
- ✓ 压力最小

**缺点**:
- ✗ 收益较慢
- ✗ 可能长期处于亏损

**适用场景**: 命中率 < 35% 或保守投资者

**示例**:
```
期数  倍数  投注   结果   盈亏    累计
1     1     5元    未中   -15元   -15元
2     2     10元   未中   -30元   -45元
3     3     15元   未中   -45元   -90元
4     4     20元   命中   +160元  +70元 ✓
```

## 📈 策略选择指南

| 命中率 | 推荐策略 | 预期ROI | 风险等级 |
|--------|----------|---------|----------|
| > 45% | 马丁格尔 | 高 | 中 |
| 40-45% | 马丁格尔 | 中-高 | 中 |
| 35-40% | 斐波那契 | 中 | 中-低 |
| 30-35% | 达朗贝尔 | 低 | 低 |
| < 30% | 不推荐投注 | 负 | 高 |

## 🎮 使用方法

### 方法1: GUI界面

1. 启动GUI: `python lucky_number_gui.py`
2. 加载数据文件
3. 点击"💰 投注策略分析"按钮
4. 查看策略对比和建议

### 方法2: 命令行演示

```bash
python demo_betting_strategy.py
```

输出包括:
- 历史回测结果
- 三种策略对比
- 下期投注建议
- TOP5预测结果

### 方法3: Python代码

```python
from betting_strategy import BettingStrategy
from top15_predictor import Top15Predictor
import pandas as pd

# 1. 加载数据
df = pd.read_csv('data/lucky_numbers.csv')

# 2. 生成预测
predictor = Top15Predictor()
top15 = predictor.predict(df['number'].values, top_k=15)
top5 = top15[:5]

# 3. 创建投注策略
betting = BettingStrategy()

# 4. 获取投注建议（假设当前连续亏损2次，累计亏损30元）
recommendation = betting.generate_next_bet_recommendation(
    consecutive_losses=2,
    total_loss=30.0,
    strategy_type='martingale'
)

# 5. 查看建议
betting.print_next_bet_recommendation(recommendation)

print(f"\n购买数字: {top5}")
print(f"投注金额: {recommendation['recommended_bet']:.2f}元")
```

## 📊 回测结果示例

基于100期真实数据的回测（命中率约40%）：

```
策略对比:
├─ 马丁格尔: 总收益+245.60元, ROI +12.3%, 最大回撤-68.50元
├─ 斐波那契: 总收益+186.30元, ROI +9.8%, 最大回撤-52.20元
└─ 达朗贝尔: 总收益+142.80元, ROI +7.6%, 最大回撤-38.90元

推荐: 马丁格尔策略（收益最高）
```

## ⚠️ 风险控制

### 1. 资金管理

- **最大倍数限制**: 默认10倍，可调整
- **最大回撤监控**: 超过阈值时暂停
- **总资金限制**: 不超过可承受范围

### 2. 止损机制

建议设置止损条件：
- 连续亏损 > 5期：暂停投注
- 累计亏损 > 100元：降低倍数或暂停
- 最大回撤 > 150元：停止投注

### 3. 盈利保护

- 达到目标收益后降低倍数
- 定期提取盈利
- 避免贪婪追加

## 🔧 参数配置

在`BettingStrategy`类中可以调整：

```python
betting = BettingStrategy(
    base_bet=5,           # 基础投注（5个号码各1元）
    win_reward=45,        # 命中奖励
    loss_penalty=15       # 未命中惩罚
)

# 调整最大倍数
betting.max_multiplier = 10  # 最大10倍
```

## 📝 实战流程

### 每期操作步骤：

1. **预测阶段**
   ```bash
   # 获取TOP15预测
   python predict_next.py
   # 或使用GUI: 点击"⭐ 综合预测 Top 15"
   ```

2. **策略分析**
   ```bash
   # 查看投注建议
   python demo_betting_strategy.py
   # 或使用GUI: 点击"💰 投注策略分析"
   ```

3. **购买决策**
   - 查看建议倍数和金额
   - 评估风险等级
   - 决定是否投注

4. **记录结果**
   - 记录实际结果
   - 更新连续亏损计数
   - 计算累计盈亏

5. **下期准备**
   - 根据结果调整策略
   - 计算新的投注倍数

## 📚 核心算法

### 马丁格尔倍数计算

```python
def calculate_optimal_bet(consecutive_losses, total_loss):
    """
    计算最优投注倍数
    
    目标: 下次命中能覆盖所有亏损并盈利
    """
    expected_profit = win_reward - base_bet - loss_penalty
    
    required_multiplier = ceil(
        (total_loss + expected_profit) / (win_reward - base_bet)
    )
    
    multiplier = min(required_multiplier, max_multiplier)
    bet_amount = multiplier * base_bet
    
    return multiplier, bet_amount
```

### 斐波那契数列

```python
def calculate_fibonacci_bet(consecutive_losses):
    """
    斐波那契投注
    
    数列: 1, 1, 2, 3, 5, 8, 13, 21, 34...
    """
    fib = [1, 1]
    for i in range(2, consecutive_losses + 1):
        fib.append(fib[-1] + fib[-2])
    
    multiplier = min(fib[consecutive_losses], max_multiplier)
    bet_amount = multiplier * base_bet
    
    return multiplier, bet_amount
```

## 💡 成功案例

### 案例1: 高命中率场景

```
场景: 连续5期，命中3次（60%命中率）
策略: 马丁格尔

期数  预测TOP5        实际  倍数  投注  结果  盈亏   累计
1    [3,15,28,33,41]  28   1     5元   命中  +40元  +40元
2    [7,19,24,36,47]  12   1     5元   未中  -15元  +25元
3    [2,18,29,35,44]  18   2     10元  命中  +80元  +105元
4    [8,16,23,38,45]  16   1     5元   命中  +40元  +145元
5    [5,14,27,32,49]  31   1     5元   未中  -15元  +130元

总结: 5期收益+130元，ROI = 130/30 = 433%
```

### 案例2: 中等命中率场景

```
场景: 连续10期，命中4次（40%命中率）
策略: 斐波那契

总投注: 115元
总奖励: 180元
净收益: +65元
ROI: 56.5%
```

## 🎓 理论基础

### 期望值计算

```
E = P(命中) × 净收益(命中) + P(未中) × 净损失(未中)

假设命中率40%，固定1倍投注:
E = 0.40 × (45-5) + 0.60 × (-15)
  = 0.40 × 40 + 0.60 × (-15)
  = 16 - 9
  = +7元 ✓ (正期望)

结论: 命中率>33.3%时，期望为正值
```

### 盈亏平衡点

```
盈亏平衡命中率 = loss_penalty / (win_reward - base_bet + loss_penalty)
                = 15 / (45 - 5 + 15)
                = 15 / 55
                = 27.3%

结论: 命中率>27.3%即可盈利
```

## 🔍 常见问题

### Q1: 为什么不是所有情况都能盈利？

A: 渐进式投注能提高盈利概率，但不能保证：
- 连续大量亏损时可能超出资金承受
- 达到最大倍数后仍可能亏损
- 实际命中率可能低于预期

### Q2: 如何选择最大倍数？

A: 建议根据资金和风险承受能力：
- 保守: 5倍 (需准备约75元)
- 中等: 10倍 (需准备约250元)
- 激进: 20倍 (需准备约1000元)

### Q3: 什么时候应该停止投注？

A: 满足以下任一条件时应停止：
- 连续亏损超过5期
- 累计亏损超过预算
- 命中率持续<30%
- 达到盈利目标

### Q4: 能否同时使用多个策略？

A: 可以，建议：
- 主策略: 基于历史表现选择
- 备用策略: 连续亏损时切换
- 组合策略: 分配资金到不同策略

## 📞 技术支持

- 查看详细日志: GUI界面"训练日志"标签页
- 运行演示: `python demo_betting_strategy.py`
- 独立测试: `python betting_strategy.py`

## 🔄 版本历史

- **v1.0** (2024-12-30)
  - 实现三种投注策略
  - GUI集成
  - 历史回测功能
  - 下期投注建议

## ⚖️ 免责声明

本系统仅供学习研究使用，投注有风险，决策需谨慎。使用者需：
- 理解并接受投资风险
- 合理控制投注金额
- 不保证盈利
- 自行承担投资后果
